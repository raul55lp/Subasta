<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        let tarjeta = false;
        let email = false;
        $(document).ready(function () {
            $('#tarjeta').on('keyup', function () {
                if ($('#tarjeta').val().length < 5) {
                    $('#tarjeta').addClass('is-invalid')
                    tarjeta = false;
                } else {
                    tarjeta = true;
                    $('#tarjeta').removeClass('is-invalid')
                }
                activar();
            });
            $('#email').on('keyup', function () {
                if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($('#email').val())) {
                    email = true;
                    $('#email').removeClass('is-invalid')
                } else {
                    $('#email').addClass('is-invalid')
                    email = false;
                }
                activar();
            });
        });
        function activar() {
            if (tarjeta && email) {
                $('#registrar').removeAttr('disabled')
            } else {
                $('#registrar').attr('disabled', '')
            }
        }
        function registrar() {
            const email = document.getElementById('email').value;
            const tarjeta = document.getElementById('tarjeta').value;
            $.post('rest/UsuarioCheck/', { email: email, tarjeta: tarjeta }, function (data) {
                const e = document.getElementById('resultado');
                if (data) {
                    e.innerHTML = 'Este usuario ya existe'
                    e.className = 'text-danger'
                } else {
                    e.innerHTML = 'Usuario creado correctamente'
                    e.className = 'text-success'
                }
            });
        }
    </script>
</head>

<body class="container-fluid">
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Navbar</a>
    </nav>
    <form action="javascript:registrar()" method="post" class="my-5  col-md-4 offset-4">
        <h5>Registro de nuevo usuario</h5>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" name="" id="email" class="form-control">
            <div class="invalid-feedback">
                El correo debe estar bien formado
            </div>
            <label for="tarjeta">Tarjeta:</label>
            <input type="number" name="" id="tarjeta" class="form-control" minlength="5">
            <div class="invalid-feedback">
                La tarjeta debe tener una longitud de por lo menos 5 d√≠gitos
            </div>
            <input type="submit" value="Registrar" id="registrar" class="btn btn-primary my-2" disabled>
            <h5 id="resultado"></h5>
        </div>
    </form>
</body>

</html>